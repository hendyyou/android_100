package cn.digione.yibaic.shop.ui;import android.graphics.drawable.ColorDrawable;import android.os.Bundle;import android.telephony.TelephonyManager;import android.text.SpannableStringBuilder;import android.text.style.TextAppearanceSpan;import android.util.Patterns;import android.view.KeyEvent;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.EditText;import android.widget.RadioButton;import android.widget.RadioGroup;import android.widget.TextView;import cn.digione.yibaic.shop.R;import cn.digione.yibaic.shop.util.Log;/** * Created with IntelliJ IDEA. * User: youzh * Date: 14-3-4 * Time: 下午4:20 */public class RegisterSelectAccountTypeFragment extends StepsFragment {    private static final int ERROR_EMAIL_USED = 2;    private static final int ERROR_NETWORK = 4;    private static final int ERROR_NETWORK_GW = 14;    private static final int ERROR_NETWORK_TIMEOUT_GW = 16;    private static final int ERROR_NO_SIM = 17;    private static final int ERROR_PHONE_USED = 1;    private static final int ERROR_SERVER = 5;    private static final int ERROR_SERVER_GW = 15;    private RadioGroup mAccountTypeRadios;    private View mEmailPanel;    private RadioButton mEmailRegioButton;    private EditText mEmailText;    private SpannableStringBuilder getErrorSpanString(int i) {        String s = getActivity().getString(i);        TextAppearanceSpan textspan = new TextAppearanceSpan(getActivity(), R.style.TextAppearance_Notice_Normal);        SpannableStringBuilder spanbuilder = new SpannableStringBuilder(s);        spanbuilder.setSpan(textspan, spanbuilder.length() - s.length(), spanbuilder.length(), 33);        return spanbuilder;    }    public int getSelectedAccountTypeIndex() {        return -1 + mAccountTypeRadios.getCheckedRadioButtonId();    }    public void onActivityCreated(Bundle bundle) {        super.onActivityCreated(bundle);        setButtonPreviousGone(true);    }    protected void onButtonNextClicked() {        Log.d("onButtonNextClicked()");        int i = 1;        final String email;        switch (getSelectedAccountTypeIndex()) {            case 0: // '\0'                TelephonyManager telephonymanager = (TelephonyManager) getActivity().getSystemService("phone");                String s = telephonymanager.getNetworkOperator();                if (telephonymanager.getSimState() != i) {                    i = 0;                }              /*  if (TextUtils.isEmpty(s) || i != 0) {                    // handleCheckFailed(17);                    return;                } else {                    // (new QuerySmsGwTask()).execute(new Void[0]);                    return;                }*/                RegisterPasswordFragment registerpasswordfragment = new RegisterPasswordFragment();                registerpasswordfragment.setNewAccountType("reg_sms");                replaceToFragment(registerpasswordfragment, false);            case 1: // '\001'                email = mEmailText.getText().toString().trim();                break;            default:                return;        }        if (!Patterns.EMAIL_ADDRESS.matcher(email).matches()) {            mEmailText.setError(getErrorSpanString(R.string.error_email));            return;        } else {           /* (new CheckEmailTask(email, new Runnable() {                public void run() {*/            RegisterPasswordFragment registerpasswordfragment = new RegisterPasswordFragment();            registerpasswordfragment.setNewAccountType("reg_email");            Bundle bundle = new Bundle();            bundle.putString("email", email);            registerpasswordfragment.setArguments(bundle);            replaceToFragment(registerpasswordfragment, false);                /*}                final String email;*/            return;        }    }    public View onCreateView(LayoutInflater layoutinflater, ViewGroup viewgroup, Bundle bundle) {		super.onCreateView(layoutinflater, viewgroup, bundle);        View view = layoutinflater.inflate(R.layout.register_select_type, viewgroup, false);        mAccountTypeRadios = (RadioGroup) view.findViewById(R.id.rg_account_types);        mEmailPanel = view.findViewById(R.id.ll_email_input_panel);        mEmailText = (EditText) view.findViewById(R.id.et_email);        mEmailText.setOnClickListener(new android.view.View.OnClickListener() {            public void onClick(View view1) {                mEmailText.setError(null);            }        });        String as[] = getResources().getStringArray(R.array.new_account_types);        int i = 0;        while (i < as.length) {            Log.d("get account reg type:" + as[i]);            RadioButton radiobutton = new RadioButton(getActivity());            radiobutton.setId(i + 1);            radiobutton.setText(as[i]);            radiobutton.setTextColor(getResources().getColorStateList(R.color.primary_text_color));            mAccountTypeRadios.addView(radiobutton, i, new ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT,                                                                                  ViewGroup.LayoutParams.WRAP_CONTENT));            if (as.length == 1) {                radiobutton.setChecked(true);                radiobutton.setBackgroundResource(R.drawable.radiobutton_single_bg);            } else if (i == 0) {                radiobutton.setChecked(true);                radiobutton.setBackgroundResource(R.drawable.radiobutton_up_bg);            } else if (i == -1 + as.length) {                radiobutton.setBackgroundResource(R.drawable.radiobutton_bottom_bg);            } else {                radiobutton.setBackgroundResource(R.drawable.radiobutton_middle_bg);            }            radiobutton.setButtonDrawable(new ColorDrawable(0));            i++;        }        mAccountTypeRadios.check(1);        mAccountTypeRadios.setOnCheckedChangeListener(new android.widget.RadioGroup.OnCheckedChangeListener() {            public void onCheckedChanged(RadioGroup radiogroup, int j) {                switch (j) {                    case 1: // '\001'                        if (mEmailRegioButton != null) {                            mEmailRegioButton.setBackgroundResource(R.drawable.radiobutton_bottom_bg);                        }                        mEmailPanel.setVisibility(View.GONE);                        displaySoftInputIfNeed(getView(), false);                        return;                    case 2: // '\002'                        mEmailRegioButton = (RadioButton) radiogroup.findViewById(j);                        mEmailRegioButton.setBackgroundResource(R.drawable.radiobottom_middle_noline_p);                        mEmailPanel.setVisibility(View.VISIBLE);                        mEmailText.requestFocus();                        displaySoftInputIfNeed(mEmailText, true);                        return;                    default:                        return;                }            }        });        mEmailText.setOnEditorActionListener(new android.widget.TextView.OnEditorActionListener() {            public boolean onEditorAction(TextView textview, int j, KeyEvent keyevent) {                if (j == 5) {                    triggerNextStep();                    return true;                } else {                    return false;                }            }        });        return view;    }    public void onResume() {        super.onResume();        boolean flag = true;        if (getSelectedAccountTypeIndex() != 1) {            flag = false;        }        displaySoftInputIfNeed(mEmailText, flag);    }}